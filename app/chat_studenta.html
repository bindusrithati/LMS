<!DOCTYPE html>
<html>
<head>
  <title>Mentor Student Chat</title>
</head>
<body>

<h3>Batch Chat</h3>
<p><b>Status:</b> <span id="status">Connecting...</span></p>

<input id="msg" placeholder="Type message" />
<button onclick="send()">Send</button>

<ul id="chat"></ul>

<script>
  let myUserId = null;
  let myRole = null;

  // üî¥ PASTE JWT TOKEN HERE
  const token ="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MiwibmFtZSI6ImJpbmR1IiwiZW1haWwiOiJiaW5kdXNyaXRoYXRpMTRAZ21haWwuY29tIiwicm9sZSI6IkFkbWluIiwicGhvbmVfbnVtYmVyIjoiMTIzNDU2Nzg5MSIsImV4cCI6MTc2OTE4MjEyMX0.f971cb-q8RWjhGqQq4r_IfOFKrpjK1CR54CcdyLQVaA";

  // üî¥ VALID BATCH ID
  const batchId = 12;

  const ws = new WebSocket(
    `ws://127.0.0.1:8000/ws/chat/batch/${batchId}?token=${token}`
  );

  ws.onopen = () => {
    document.getElementById("status").innerText = "Connected ‚úÖ";
  };

  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);

    // INIT MESSAGE (sent once)
    if (data.type === "init") {
      myUserId = data.user_id;
      myRole = data.role;
      return;
    }

    const li = document.createElement("li");

    if (data.from_user_id === myUserId) {
      li.innerText = `You (${myRole}): ${data.message}`;
    } else {
      li.innerText = `${data.from_role}: ${data.message}`;
    }

    document.getElementById("chat").appendChild(li);
  };

  ws.onclose = () => {
    document.getElementById("status").innerText = "Disconnected ‚ùå";
  };

  function send() {
    const input = document.getElementById("msg");
    ws.send(JSON.stringify({ message: input.value }));
    input.value = "";
  }
</script>

</body>
</html>
